<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %} 
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="{% static 'icon.png' %}" type="image/png">

    <title>Planora - Plan & Work</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- SweetAlert Library -->
</head>
<body class="relative flex min-h-screen items-center justify-center bg-gradient-to-br from-blue-200 to-purple-400">
    <div class="w-full max-w-96 rounded-lg bg-slate-900 p-10 text-sm text-indigo-300 sm:w-96">
        <h1 class="mb-4 text-center text-3xl font-semibold text-white">Update Password</h1>
        <p class="mb-6 text-center text-sm">Enter your old password and set a new one.</p>

        <form id="passwordForm">
            <!-- Username -->
            <div class="mb-5 flex gap-3 rounded-full bg-[#333A5c] px-6 py-3">
                <input type="text" id="username" name="username" placeholder="Username" class="w-full border-none outline-none bg-transparent text-white" required />
            </div>

            <!-- Old Password -->
            <div class="mb-5 flex gap-3 rounded-full bg-[#333A5c] px-6 py-3">
                <input type="password" id="old_password" name="old_password" placeholder="Old Password" class="w-full border-none outline-none bg-transparent text-white" required />
            </div>

            <!-- New Password -->
            <div class="mb-5 flex gap-3 rounded-full bg-[#333A5c] px-6 py-3">
                <input type="password" id="new_password" name="new_password" placeholder="New Password" class="w-full border-none outline-none bg-transparent text-white" required />
            </div>

            <!-- Submit Button -->
            <button type="submit" class="w-full cursor-pointer rounded-full bg-gradient-to-r from-indigo-400 to-indigo-900 py-3 font-medium tracking-wide text-white">
                Update Password
            </button>
        </form>
    </div>

    <script>
        document.getElementById("passwordForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const username = document.getElementById("username").value.trim();
            const oldPassword = document.getElementById("old_password").value.trim();
            const newPassword = document.getElementById("new_password").value.trim();

            // Validation checks
            if (!username) {
                Swal.fire("Error", "Username cannot be blank!", "error");
                return;
            }

            if (!oldPassword) {
                Swal.fire("Error", "Old Password cannot be blank!", "error");
                return;
            }

            const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/;
            if (!passwordPattern.test(newPassword)) {
                Swal.fire("Error", "Password must be at least 6 characters long, contain one uppercase letter, one lowercase letter, one number, and one special character.", "error");
                return;
            }

            // Sending data to the server
            const formData = new FormData();
            formData.append("username", username);
            formData.append("old_password", oldPassword);
            formData.append("new_password", newPassword);

            fetch("/update_password", {
                method: "POST",
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                
                    Swal.fire("Success", "Password updated successfully!", "success").then(() => {
                        window.location.href = "/"; // Redirect to login page
                    });
                })
                
            .catch(error => {
                Swal.fire("Error", "Something went wrong!", "error");
                console.error("Error:", error);
            });
        });
    </script>
</body>
</html>
